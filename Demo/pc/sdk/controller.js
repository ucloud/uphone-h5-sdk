'use strict';import{transKeyCode,PeerConnectionClient}from'./client.js';const control=require('control');var CODE_NUMBER={'CodeLButtonDown':0x65,'CodeLButtonUp':0x66,'CodeMouseMove':0x67,'CodeLButtonDBClick':0x68,'CodeRButtonDown':0x69,'CodeRButtonUp':0x6a,'CodeKeyDown':0x6b,'CodeKeyUp':0x6c,'CodeChar':0x6d,'CodeMButtonDown':0xd2,'CodeMButtonUp':0xd3,'CodeMouseWheel':0x70,'CodeDefinition':0x74,'CodeFingerDown':0x75,'CodeFingerUp':0x76,'CodeFingerMove':0x73,'CodeFingersDown':0x71,'CodeFingersUp':0x72,'CodeClipBoard':0x84,'CodeStartGame':0x85};class AppController{constructor(_0x3c50ef){this['pcClient_']=null;this['offsetX']='';this['offsetY']='';this['upsetX']='';this['upsetY']='';this['moveX']='';this['moveY']='';this['deltaY']='';this['keyCode']=0xac4c0^0xac4c0;this['touches']=[];this['fingers']=![];this['keyCodearr']=[];this['fingervalue']={};this['setDefinite']='';this['videoWidth']='';this['videoHeight']='';this['messagedata']={};this['remoteStream_']=null;this['count']=0x3ae97^0x3ae97;this['timestamp']=null;this['startTime']=null;this['currentRoundTripTime']={'currentRoundTripTime':''};this['framesPerSecond']={'framesPerSecond':''};this['answercode']={'answercode':''};this['iceconnectionstate']={'iceconnectionstate':''};this['resolution']={'status':'','data':{}};this['gamestatus']={'gamestatus':''};this['useragent']='';this['remoteVideo_']=null;this['h5touchdown']=![];this['webtouchdown']=![];this['getUserAgent']();this['sysInfo']=this['getExplore']();this['loadingParams_']={..._0x3c50ef,'peerConnectionConfig':{'iceServers':[{'urls':'turn:turn.ugame.ucloud.cn:3478','username':'ucloud','credential':'ucloud.123cn'}]}};}['sendmouseDown'](_0x1c4b04){this['webtouchdown']=!![];let _0x34b0e5={'name':'webtouchstart','button':_0x1c4b04['button'],'offsetX':_0x1c4b04['offsetX'],'offsetY':_0x1c4b04['offsetY'],'timeStamp':_0x1c4b04['timeStamp']};this['sendmessage'](_0x34b0e5);}['sendmouseUp'](_0x58a1af){this['webtouchdown']=![];let _0x2842b1={'name':'webtouchend','button':_0x58a1af['button'],'offsetX':_0x58a1af['offsetX'],'offsetY':_0x58a1af['offsetY'],'timeStamp':_0x58a1af['timeStamp']};this['sendmessage'](_0x2842b1);}['sendmouseMove'](_0x267ec3){if(this['webtouchdown']){let _0x37e83b={'name':'webtouchmove','button':_0x267ec3['button'],'offsetX':_0x267ec3['offsetX'],'offsetY':_0x267ec3['offsetY'],'timeStamp':_0x267ec3['timeStamp']};this['sendmessage'](_0x37e83b);}}['sendmouseOut'](_0x3a2129){if(this['webtouchdown']){this['webtouchdown']=![];let _0x2cf572={'name':'webtouchend','button':_0x3a2129['button'],'offsetX':_0x3a2129['offsetX'],'offsetY':_0x3a2129['offsetY'],'timeStamp':_0x3a2129['timeStamp']};this['sendmessage'](_0x2cf572);}}['sendkeyDown'](_0x450521){let _0x146724={'name':'keydown','keyCode':transKeyCode(_0x450521['keyCode']),'timeStamp':_0x450521['timeStamp']};if((_0x450521['ctrlKey']||_0x450521['metaKey'])&&_0x450521['keyCode']===(0xd129c^0xd12ca)){_0x146724['name']='clipboard';}if(_0x450521['keyCode']==(0x991b1^0x991ea)||_0x450521['keyCode']==(0x960c1^0x960d3)||_0x450521['keyCode']==(0x70a34^0x70a3d)){_0x450521['preventDefault']();return;}this['sendmessage'](_0x146724);}['sendkeyUp'](_0x1bb1a3){let _0x315960={'name':'keyup','keyCode':transKeyCode(_0x1bb1a3['keyCode']),'timeStamp':_0x1bb1a3['timeStamp']};if(_0x1bb1a3['keyCode']==(0x851be^0x851e5)||_0x1bb1a3['keyCode']==(0x3d7b6^0x3d7a4)||_0x1bb1a3['keyCode']==(0x61f82^0x61f8b)){_0x1bb1a3['preventDefault']();return;}this['sendmessage'](_0x315960);}['sendtouchStart'](_0x2c0784){this['h5touchdown']=!![];let _0x25a1ad={'name':'h5touchstart','changedTouches':_0x2c0784['changedTouches'],'currentTarget':_0x2c0784['currentTarget'],'touches':_0x2c0784['touches'],'timeStamp':_0x2c0784['timeStamp']};console['log'](_0x25a1ad);this['sendmessage'](_0x25a1ad);}['sendtouchEnd'](_0x46dfae){this['h5touchdown']=![];let _0x286913={'name':'h5touchend','changedTouches':_0x46dfae['changedTouches'],'currentTarget':_0x46dfae['currentTarget'],'touches':_0x46dfae['touches'],'timeStamp':_0x46dfae['timeStamp']};this['sendmessage'](_0x286913);}['sendtouchMove'](_0xdd3551){if(this['h5touchdown']){let _0x5c4320={'name':'h5touchmove','changedTouches':_0xdd3551['changedTouches'],'currentTarget':_0xdd3551['currentTarget'],'touches':_0xdd3551['touches'],'timeStamp':_0xdd3551['timeStamp']};this['sendmessage'](_0x5c4320);}}['getUserAgent'](){var _0x4c3c25=navigator['userAgent']['toLowerCase']();var _0x37356c=_0x4c3c25['match'](/ipad/i)=='ipad';var _0x2c02ea=_0x4c3c25['match'](/iphone os/i)=='iphone\x20os';var _0x241897=_0x4c3c25['match'](/midp/i)=='midp';var _0x333591=_0x4c3c25['match'](/rv:1.2.3.4/i)=='rv:1.2.3.4';var _0x4438dc=_0x4c3c25['match'](/ucweb/i)=='ucweb';var _0x1cf0b2=_0x4c3c25['match'](/android/i)=='android';var _0x521c6f=_0x4c3c25['match'](/windows ce/i)=='windows\x20ce';var _0x593f5f=_0x4c3c25['match'](/windows mobile/i)=='windows\x20mobile';if(!(_0x37356c||_0x2c02ea||_0x241897||_0x333591||_0x4438dc||_0x1cf0b2||_0x521c6f||_0x593f5f)){this['remoteVideo_']=document['querySelector']('#remote-video');this['remoteVideo_']['addEventListener']('mousedown',this['sendmouseDown']['bind'](this));this['remoteVideo_']['addEventListener']('mouseup',this['sendmouseUp']['bind'](this));this['remoteVideo_']['addEventListener']('mousemove',this['sendmouseMove']['bind'](this));this['remoteVideo_']['addEventListener']('mouseout',this['sendmouseOut']['bind'](this));document['addEventListener']('keydown',this['sendkeyDown']['bind'](this));document['addEventListener']('keyup',this['sendkeyUp']['bind'](this));console['log']('当前是电脑打开');this['useragent']='web';}else{this['remoteVideo_']=document['querySelector']('#phone-video');this['remoteVideo_']['addEventListener']('touchstart',this['sendtouchStart']['bind'](this));this['remoteVideo_']['addEventListener']('touchend',this['sendtouchEnd']['bind'](this));this['remoteVideo_']['addEventListener']('touchmove',this['sendtouchMove']['bind'](this));console['log']('当前是手机打开');this['useragent']='h5';}console['log'](_0x4c3c25);}['getExplore'](){var _0xec4b5c={};var _0x240073=navigator['userAgent']['toLowerCase']();var _0x34c806;(_0x34c806=_0x240073['match'](/rv:([\d.]+)\) like gecko/))?_0xec4b5c['ie']=_0x34c806[0x9a8be^0x9a8bf]:(_0x34c806=_0x240073['match'](/msie ([\d\.]+)/))?_0xec4b5c['ie']=_0x34c806[0x67741^0x67740]:(_0x34c806=_0x240073['match'](/edge\/([\d\.]+)/))?_0xec4b5c['edge']=_0x34c806[0x403ac^0x403ad]:(_0x34c806=_0x240073['match'](/firefox\/([\d\.]+)/))?_0xec4b5c['firefox']=_0x34c806[0x5e3fb^0x5e3fa]:(_0x34c806=_0x240073['match'](/(?:opera|opr).([\d\.]+)/))?_0xec4b5c['opera']=_0x34c806[0xe0663^0xe0662]:(_0x34c806=_0x240073['match'](/chrome\/([\d\.]+)/))?_0xec4b5c['chrome']=_0x34c806[0x1]:(_0x34c806=_0x240073['match'](/version\/([\d\.]+).*safari/))?_0xec4b5c['safari']=_0x34c806[0x1]:0x0;if(_0xec4b5c['ie'])return'IE:\x20'+_0xec4b5c['ie'];if(_0xec4b5c['edge'])return'EDGE:\x20'+_0xec4b5c['edge'];if(_0xec4b5c['firefox'])return'Firefox:\x20'+_0xec4b5c['firefox'];if(_0xec4b5c['chrome'])return'Chrome:\x20'+_0xec4b5c['chrome'];if(_0xec4b5c['opera'])return'Opera:\x20'+_0xec4b5c['opera'];if(_0xec4b5c['safari'])return'Safari:\x20'+_0xec4b5c['safari'];return'Unkonwn';}['startConnection'](){this['closeConnection']();if(this['loadingParams_']['Id']){this['trace_']('start\x20to\x20connect:\x20'+this['loadingParams_']['Id']);this['startSignaling_']();this['timestamp']=Date['now']();}}['reStart'](){this['closeConnection']();setTimeout(()=>{this['startConnection']();},0x1de22^0x1ddca);}['getLastTimeStamp'](){return this['timestamp'];}['startSignaling_'](){this['trace_']('Starting\x20signaling.');this['startTime']=window['performance']['now']();this['maybeCreatePcClientAsync_']()['then'](function(){this['pcClient_']['startCreateDataChannel']();this['pcClient_']['startAsCaller'](this['loadingParams_']['offerOptions']);}['bind'](this))['catch'](function(_0x23fcb0){this['trace_']('Create\x20PeerConnection\x20exception:\x20'+_0x23fcb0['message']);}['bind'](this));}['maybeCreatePcClientAsync_'](){return new Promise(function(_0x5ba3cb,_0x3e9d9b){if(this['pcClient_']){_0x5ba3cb();return;}this['createPcClient_']();_0x5ba3cb();}['bind'](this));}['createPcClient_'](){this['pcClient_']=new PeerConnectionClient(this['loadingParams_'],this['startTime']);this['pcClient_']['onremotestreamadded']=this['onRemoteStreamAdded_']['bind'](this);this['pcClient_']['onerror']=this['trace_']['bind'](this);this['pcClient_']['onchangedefinit']=this['onchangedefinit_']['bind'](this);this['pcClient_']['onchangestatus']=this['onchangestatus']['bind'](this);this['pcClient_']['onchangeicestatus']=this['onchangeicestatus']['bind'](this);this['pcClient_']['onresolutionstatus']=this['onresolutionstatus']['bind'](this);this['pcClient_']['startgamestatus']=this['startgamestatus']['bind'](this);this['pcClient_']['onmessagehandle']=this['onmessagehandle']['bind'](this);this['pcClient_']['onchannelstatus']=this['onchannelstatus']['bind'](this);this['getpeerstates']();}['onchangestatus'](_0x567a26){this['answercode']['answercode']=_0x567a26;}['onchangeicestatus'](_0x4d29fd){this['iceconnectionstate']['iceconnectionstate']=_0x4d29fd;}['onchannelstatus'](_0xb0efcb){if(_0xb0efcb=='open'){this['channelopened']=!![];if(!this['hassended']){if(this['doUpdateWork'](this['updatekind'])){this['trace_'](this['loadingParams_']['Id']+'\x20onchannelstatus\x20send\x20start\x20update\x20kind:\x20'+this['updatekind']);}this['hassended']=!![];this['beforeopenkind']=0x0;}}else{this['channelopened']=![];}this['trace_']('channel\x20state:\x20'+_0xb0efcb+'\x20'+this['channelopened']);}['doUpdateWork'](_0x3ac3e7){if(this['maincontrol']){return 0xbbc85^0xbbc85;}if(_0x3ac3e7==0x1){this['onStartUpdate']();}else if(_0x3ac3e7==0x2){this['onStopUpdate']();}else{this['trace_']('nothing\x20to\x20do.');}return 0x1;}['onmessagehandle'](_0x24bd62){console['log'](_0x24bd62);this['trace_'](_0x24bd62);var _0x38ce9f=JSON['parse'](_0x24bd62);var _0x2a6e9a=_0x38ce9f['code'];var _0x400bfa=_0x38ce9f['data'];switch(_0x2a6e9a){case CODE_NUMBER['CodeWeixinPay']:var _0x581836=_0x400bfa['type'];var _0x22fff8=_0x400bfa['uri'];this['trace_'](_0x581836+'\x20'+_0x22fff8);this['sendPayRequest_'](_0x22fff8);break;case CODE_NUMBER['CodeConnDisplaced']:this['answercode']['answercode']=_0x2a6e9a;break;case CODE_NUMBER['CodeStartGame']:this['startgamestatus'](_0x38ce9f);break;case CODE_NUMBER['CodeDefinition']:this['onresolutionstatus'](_0x38ce9f);break;default:break;}}['onresolutionstatus'](_0x23b4e8){console['log'](_0x23b4e8);let _0x4270dc={'status':_0x23b4e8['status'],'data':_0x23b4e8['data']};if(_0x23b4e8['data']['height']==0x870&&_0x23b4e8['data']['width']==0x438){_0x4270dc['id']=0x6;}if(_0x23b4e8['data']['height']==0x438&&_0x23b4e8['data']['width']==(0x69dd3^0x69a53)){_0x4270dc['id']=0x5;}if(_0x23b4e8['data']['height']==0x5a0&&_0x23b4e8['data']['width']==(0x55908^0x55bd8)){_0x4270dc['id']=0xb3f35^0xb3f36;}if(_0x23b4e8['data']['height']==0x2d0&&_0x23b4e8['data']['width']==0x500){_0x4270dc['id']=0x2;}if(_0x23b4e8['data']['height']==0x21c&&_0x23b4e8['data']['width']==0x3c0){_0x4270dc['id']=0x1;}if(_0x23b4e8['data']['height']==0x3c0&&_0x23b4e8['data']['width']==(0x46674^0x46794)){_0x4270dc['id']=0xcd63f^0xcd63f;}this['resolution']['id']=_0x4270dc['id'];this['resolution']['status']=_0x4270dc['status'];this['resolution']['data']=_0x4270dc['data'];}['startgamestatus'](_0x1cd0db){if(_0x1cd0db['error']==(0x34772^0x34772)){this['gamestatus']['gamestatus']='success';}else{this['gamestatus']['gamestatus']='fail';}}['onstatus'](_0x1274b7,_0x332318){if(_0x1274b7=='devicestatus'){var _0x451e27=this['answercode']['answercode'];Object['defineProperty'](this['answercode'],'answercode',{'set':function(_0x2b5c79){var _0x408eae=_0x2b5c79;if(_0x451e27!=_0x408eae){_0x332318(_0x408eae);_0x451e27=_0x408eae;}else{_0x332318(_0x408eae);}}});}else if(_0x1274b7=='networkstatus'){var _0x420978=this['iceconnectionstate']['iceconnectionstate'];Object['defineProperty'](this['iceconnectionstate'],'iceconnectionstate',{'set':function(_0x229be1){var _0x5e8321=_0x229be1;if(_0x420978!==_0x5e8321){_0x332318(_0x5e8321);_0x420978=_0x5e8321;}else{_0x332318(_0x5e8321);}}});}else if(_0x1274b7=='resolution'){var _0x580c1b=this['resolution']['status'];Object['defineProperty'](this['resolution'],'status',{'set':function(_0x516867){var _0x4333bf=_0x516867;if(_0x580c1b!==_0x4333bf){_0x332318(_0x4333bf);_0x580c1b=_0x4333bf;}else{_0x332318(_0x4333bf);}}});}else if(_0x1274b7=='gamestatus'){var _0x580c1b=this['gamestatus']['gamestatus'];Object['defineProperty'](this['gamestatus'],'gamestatus',{'set':function(_0x4c0d6f){var _0x18dd8d=_0x4c0d6f;if(_0x580c1b!==_0x18dd8d){_0x332318(_0x18dd8d);_0x580c1b=_0x18dd8d;}else{_0x332318(_0x18dd8d);}}});}}['hangup_'](){this['trace_']('Hanging\x20up.');this['hide_'](this['icons_']);this['displayStatus_']('Hanging\x20up');this['transitionToDone_']();this['startTime']=null;if(!this['loadingParams_']['Id']){return;}this['closeClient_']();document['onkeypress']=null;window['onmousemove']=null;}['onchangedefinit_'](_0x2580e2={}){this['messagedata']=_0x2580e2;console['log'](this['messagedata']);}['closeClient_'](){if(this['pcClient_']){this['pcClient_']['close']();this['pcClient_']=null;}}['Hangup'](){this['remoteStream_']=null;this['loadingParams_']['Id']='';this['trace_']('Hanging\x20up.');this['closeClient_']();}['closeConnection'](){this['remoteStream_']=null;this['trace_']('close\x20connection...');this['closeClient_']();}['onRemoteHangup_'](){this['displayStatus_']('The\x20remote\x20side\x20hung\x20up.');this['transitionToWaiting_']();this['closeClient_']();}['onRemoteSdpSet_'](_0x4bd83d){if(_0x4bd83d){this['trace_']('Waiting\x20for\x20remote\x20video.');this['waitForRemoteVideo_']();}else{this['trace_']('No\x20remote\x20video\x20stream;\x20not\x20waiting\x20for\x20media\x20to\x20arrive.');this['transitionToActive_']();}}['waitForRemoteVideo_'](){console['log'](this['remoteVideo_']);if(this['remoteVideo_']['readyState']>=(0xca722^0xca720)){this['trace_']('Remote\x20video\x20started;\x20currentTime:\x20'+this['remoteVideo_']['currentTime']);this['transitionToActive_']();}else{this['remoteVideo_']['oncanplay']=this['waitForRemoteVideo_']['bind'](this);}}['onRemoteStreamAdded_'](_0x3de0f1){let _0x4f8fc2=this;let _0x44389e=this;this['remoteStream_']=_0x3de0f1;this['trace_']('Remote\x20stream\x20added.');if(this['remoteVideo_']){this['remoteVideo_']['onloadeddata']=function _0x18c580(){_0x4f8fc2['videoWidth']=this['videoWidth'];_0x4f8fc2['videoHeight']=this['videoHeight'];};this['remoteVideo_']['onresize']=function _0x4f83bd(){};}if(this['remoteVideoResetTimer_']){clearTimeout(this['remoteVideoResetTimer_']);this['remoteVideoResetTimer_']=null;}}['getRemoteStream'](){return this['remoteStream_'];}['getpeerstates'](){var _0x23ad72=this;if(this['pcClient_']){this['statstimer']=setInterval(()=>{if(this['pcClient_']!=null){this['pcClient_']['getPeerConnectionStats'](this['getstats']['bind'](_0x23ad72));}},0x3e8);}}['getstats'](_0x526ab8){_0x526ab8['forEach'](_0x1ac167=>{if(_0x1ac167['type']=='candidate-pair'&&_0x1ac167['currentRoundTripTime']){this['currentRoundTripTime']['currentRoundTripTime']=_0x1ac167['currentRoundTripTime']*(0x3a270^0x3a198);}if(_0x1ac167['type']=='inbound-rtp'&&_0x1ac167['framesPerSecond']){this['framesPerSecond']['framesPerSecond']=_0x1ac167['framesPerSecond'];}});}['getNetDelay'](_0x15f073){if(this['currentRoundTripTime']['currentRoundTripTime']){_0x15f073(this['currentRoundTripTime']['currentRoundTripTime']);var _0xa6762=this['currentRoundTripTime']['currentRoundTripTime'];Object['defineProperty'](this['currentRoundTripTime'],'currentRoundTripTime',{'set':function(_0x2e43f8){var _0x37f0ac=_0x2e43f8;if(_0xa6762!=_0x37f0ac){_0x15f073(_0x37f0ac);_0xa6762=_0x37f0ac;}}});}else{setTimeout(()=>{this['getNetDelay'](_0x15f073);},0xa5d89^0xa5e61);}}['getcurrentfps'](_0xc6fbbd){if(this['framesPerSecond']['framesPerSecond']){_0xc6fbbd(this['framesPerSecond']['framesPerSecond']);var _0x37e376=this['framesPerSecond']['framesPerSecond'];Object['defineProperty'](this['framesPerSecond'],'framesPerSecond',{'set':function(_0x309c33){var _0x4323b7=_0x309c33;if(_0x37e376!=_0x4323b7){_0xc6fbbd(_0x4323b7);_0x37e376=_0x4323b7;}}});}else{setTimeout(()=>{this['getcurrentfps'](_0xc6fbbd);},0xc00e2^0xc030a);}}['sendmessage'](_0x5f2b48){this['timestamp']=Date['now']();var _0x2532b0={'name':_0x5f2b48['name']||'','gamename':_0x5f2b48['gamename']||'','jobid':_0x5f2b48['jobid']||'','button':_0x5f2b48['button']||'','offsetWidth':_0x5f2b48['offsetWidth']||'','offsetHeight':_0x5f2b48['offsetHeight']||'','offsetX':_0x5f2b48['offsetX']||'','offsetY':_0x5f2b48['offsetY']||'','keyCode':_0x5f2b48['keyCode']||'','changedTouches':_0x5f2b48['changedTouches']||[],'currentTarget':_0x5f2b48['currentTarget']||{},'touches':_0x5f2b48['touches']||[],'timeStamp':_0x5f2b48['timeStamp']||''};if(_0x2532b0['name']=='webtouchstart'){this['WebTouchDownSend'](_0x2532b0);}if(_0x2532b0['name']=='webtouchend'){this['WebTouchEndSend'](_0x2532b0);}if(_0x2532b0['name']=='webtouchmove'){this['WebTouchMoveSend'](_0x2532b0);}if(_0x2532b0['name']=='keydown'||_0x2532b0['name']=='keyup'){this['onKeyCodeSend'](_0x2532b0);}if(_0x2532b0['name']=='clipboard'){this['onSendClipboard']();}if(_0x2532b0['name']=='h5touchstart'){this['H5TouchDownSend'](_0x2532b0);}if(_0x2532b0['name']=='h5touchend'){this['H5TouchEndSend'](_0x2532b0);}if(_0x2532b0['name']=='h5touchmove'){this['H5TouchMoveSend'](_0x2532b0);}if(_0x2532b0['name']=='startgame'){this['startGame'](_0x2532b0);}}['startGame'](_0xf11b96){var _0xf11b96={'code':CODE_NUMBER['CodeStartGame'],'body':{'name':_0xf11b96['gamename'],'jobid':_0xf11b96['jobid']}};this['onSendChannelData_'](JSON['stringify'](_0xf11b96))['then'](_0x190f53=>{console['log'](_0x190f53);});}['WebTouchDownSend'](_0x2d3f27){this['touches']['push'](_0x2d3f27);var _0x33ed1c=control['lookup']('finger');var _0x4f9cbf=control['lookup']('raw_msg');var _0x5935b8={'code':0x73,'msg':'','motionFs':[],'timestamp':_0x2d3f27['timeStamp']*0x3e8};var _0x488068;this['touches']['forEach']((_0x5a5c72,_0x35969e)=>{if(this['remoteVideo_']){var _0x508bd3={'fid':Math['abs'](_0x5a5c72['button']),'x':_0x5a5c72['offsetX']/this['remoteVideo_']['offsetWidth'],'y':_0x5a5c72['offsetY']/this['remoteVideo_']['offsetHeight']};}else{var _0x508bd3={'fid':Math['abs'](_0x5a5c72['button']),'x':_0x5a5c72['offsetX']/_0x5a5c72['offsetWidth'],'y':_0x5a5c72['offsetY']/_0x5a5c72['offsetHeight']};}_0x5935b8['motionFs']['push'](_0x33ed1c['create'](_0x508bd3));});_0x488068=_0x4f9cbf['encode'](_0x4f9cbf['create'](_0x5935b8))['finish']();this['onSendChannelData_'](_0x488068)['then'](_0x1ac770=>{});}['WebTouchEndSend'](_0x1a6588){var _0x334098='';this['touches']['forEach']((_0x3a44be,_0x3b12eb)=>{if(_0x3a44be['button']==_0x1a6588['button']){_0x334098=_0x3b12eb;}});this['touches']['splice'](_0x334098,0x58937^0x58936);var _0x5b9cf7=control['lookup']('finger');var _0x55e0fc=control['lookup']('raw_msg');var _0x58fc6d={'code':0x73,'msg':'','motionFs':[],'timestamp':_0x1a6588['timeStamp']*0x3e8};var _0x2afcc1;this['touches']['length']&&this['touches']['forEach']((_0x4709b5,_0x5860f6)=>{if(this['remoteVideo_']){var _0x13e885={'fid':Math['abs'](_0x4709b5['button']),'x':_0x4709b5['offsetX']/this['remoteVideo_']['offsetWidth'],'y':_0x4709b5['offsetY']/this['remoteVideo_']['offsetHeight']};}else{var _0x13e885={'fid':Math['abs'](_0x4709b5['button']),'x':_0x4709b5['offsetX']/_0x4709b5['offsetWidth'],'y':_0x4709b5['offsetY']/_0x4709b5['offsetHeight']};}_0x58fc6d['motionFs']['push'](_0x5b9cf7['create'](_0x13e885));});_0x2afcc1=_0x55e0fc['encode'](_0x55e0fc['create'](_0x58fc6d))['finish']();this['onSendChannelData_'](_0x2afcc1)['then'](_0x34accd=>{});}['WebTouchMoveSend'](_0x13d407){var _0x3b712c=control['lookup']('finger');var _0x1308b3=control['lookup']('raw_msg');var _0x54ca67={'code':0x73,'msg':'','motionFs':[],'timestamp':_0x13d407['timeStamp']*0x3e8};var _0x5b89c5;if(this['remoteVideo_']){var _0x447cf2={'fid':Math['abs'](_0x13d407['button']),'x':_0x13d407['offsetX']/this['remoteVideo_']['offsetWidth'],'y':_0x13d407['offsetY']/this['remoteVideo_']['offsetHeight']};}else{var _0x447cf2={'fid':Math['abs'](_0x13d407['button']),'x':_0x13d407['offsetX']/_0x13d407['offsetWidth'],'y':_0x13d407['offsetY']/_0x13d407['offsetHeight']};}_0x54ca67['motionFs']['push'](_0x3b712c['create'](_0x447cf2));_0x5b89c5=_0x1308b3['encode'](_0x1308b3['create'](_0x54ca67))['finish']();this['onSendChannelData_'](_0x5b89c5)['then'](_0x45ee07=>{});}['onKeyCodeSend'](_0x2ba25f){var _0x1e8adc=control['lookup']('raw_msg');var _0x5e1caa=_0x2ba25f['keyCode'];var _0x24f0b4={'msg':{'@type':'ucloud.kb','v':_0x5e1caa},'timestamp':_0x2ba25f['timeStamp']*0x3e8};if(_0x2ba25f['name']=='keydown'){_0x24f0b4['code']=CODE_NUMBER['CodeKeyDown'];}else{_0x24f0b4['code']=CODE_NUMBER['CodeKeyUp'];}var _0x5e7b8a=_0x1e8adc['encode'](_0x1e8adc['fromObject'](_0x24f0b4))['finish']();console['log'](_0x1e8adc['decode'](_0x5e7b8a));this['onSendChannelData_'](_0x5e7b8a)['then'](_0x58f378=>{});}['onSendClipboard'](){if(navigator['clipboard']===undefined){alert('当前浏览器版本不支持剪切操作');return;}navigator['clipboard']['readText']()['then'](_0x469409=>{if(_0x469409['length']>0x0){var _0x36f3d9={'body':{'data':_0x469409}};console['log'](_0x36f3d9);_0x36f3d9['code']=CODE_NUMBER['CodeClipBoard'];this['onSendChannelData_'](JSON['stringify'](_0x36f3d9))['then'](_0x57d6d9=>{});}});}['H5TouchDownSend'](_0x4b108b){var _0x14d11f=control['lookup']('finger');var _0x11cf93=control['lookup']('raw_msg');var _0x441549={'code':0x73,'msg':'','motionFs':[],'timestamp':_0x4b108b['timeStamp']*(0xc05b0^0xc0658)};var _0x2dc11b;let _0x1d11cc=[..._0x4b108b['touches']];_0x1d11cc['length']&&_0x1d11cc['forEach'](_0x19f1ee=>{console['log'](_0x19f1ee);let _0x4075ea=_0x19f1ee;let _0x522f0e=_0x4075ea['clientX']-_0x4075ea['target']['offsetLeft'];let _0x467e25=_0x4075ea['clientY']-_0x4075ea['target']['offsetTop'];let _0x138b05=_0x522f0e/this['remoteVideo_']['offsetWidth'];let _0x2d14a8=_0x467e25/this['remoteVideo_']['offsetHeight'];let _0x3d420f={'fid':Math['abs'](_0x4075ea['identifier']),'x':_0x138b05,'y':_0x2d14a8};_0x441549['motionFs']['push'](_0x14d11f['create'](_0x3d420f));});_0x2dc11b=_0x11cf93['encode'](_0x11cf93['create'](_0x441549))['finish']();console['log'](_0x2dc11b);if(this['remoteStream_']){this['onSendChannelData_'](_0x2dc11b)['then'](_0x206b65=>{console['log'](_0x206b65);});}}['H5TouchEndSend'](_0x3fd0ed){var _0x2a4eab=control['lookup']('finger');var _0x4f8a49=control['lookup']('raw_msg');var _0x5b17bc={'code':0x73,'msg':'','motionFs':[],'timestamp':_0x3fd0ed['timeStamp']*0x3e8};var _0x397d05;let _0x66f9db=[..._0x3fd0ed['touches']];_0x66f9db['length']&&_0x66f9db['forEach'](_0x4d0c19=>{let _0x27c77e=_0x4d0c19;let _0x276f42=_0x27c77e['clientX']-_0x27c77e['target']['offsetLeft'];let _0x5e84d0=_0x27c77e['clientY']-_0x27c77e['target']['offsetTop'];let _0x587649=_0x276f42/this['remoteVideo_']['offsetWidth'];let _0x4c0654=_0x5e84d0/this['remoteVideo_']['offsetHeight'];let _0x3d6839={'fid':Math['abs'](_0x27c77e['identifier']),'x':_0x587649,'y':_0x4c0654};_0x5b17bc['motionFs']['push'](_0x2a4eab['create'](_0x3d6839));});_0x397d05=_0x4f8a49['encode'](_0x4f8a49['create'](_0x5b17bc))['finish']();if(this['remoteStream_']){this['onSendChannelData_'](_0x397d05)['then'](_0x4b6c19=>{});}}['H5TouchMoveSend'](_0x280d2e){var _0x149279=control['lookup']('finger');var _0x18a7f6=control['lookup']('raw_msg');var _0x47378f={'code':0x73,'msg':'','motionFs':[],'timestamp':_0x280d2e['timeStamp']*(0x9c942^0x9caaa)};var _0x1cbe53;let _0x1ad2f5=[..._0x280d2e['touches']];_0x1ad2f5['length']&&_0x1ad2f5['forEach'](_0x5e573c=>{let _0x4c835b=_0x5e573c;let _0x3fe103=_0x4c835b['clientX']-_0x4c835b['target']['offsetLeft'];let _0x43c4a6=_0x4c835b['clientY']-_0x4c835b['target']['offsetTop'];let _0x59d2aa=_0x3fe103/this['remoteVideo_']['offsetWidth'];let _0x1f35a9=_0x43c4a6/this['remoteVideo_']['offsetHeight'];let _0x7ad81d={'fid':Math['abs'](_0x4c835b['identifier']),'x':_0x59d2aa,'y':_0x1f35a9};_0x47378f['motionFs']['push'](_0x149279['create'](_0x7ad81d));});_0x1cbe53=_0x18a7f6['encode'](_0x18a7f6['create'](_0x47378f))['finish']();if(this['remoteStream_']){this['onSendChannelData_'](_0x1cbe53)['then'](_0x218cf7=>{});}}['changeResolution'](_0x3b5574){var _0xe446ca=control['lookup']('raw_msg');var _0x489db4;var _0x37d508={'@type':'ucloud.resolution'};if(_0x3b5574==(0xbabf2^0xbabf2)){_0x37d508['r']=_0x3b5574,_0x37d508['w']=0xd0e4f^0xd0faf,_0x37d508['h']=0x3c0;}if(_0x3b5574==0x1){_0x37d508['r']=_0x3b5574,_0x37d508['w']=0x21c,_0x37d508['h']=0x3c0;}if(_0x3b5574==(0x8f142^0x8f140)){_0x37d508['r']=_0x3b5574,_0x37d508['w']=0x2d0,_0x37d508['h']=0x23f3d^0x23a3d;}if(_0x3b5574==0x3){_0x37d508['r']=_0x3b5574,_0x37d508['w']=0x2d0,_0x37d508['h']=0x5a0;}if(_0x3b5574==0x4){_0x37d508['r']=_0x3b5574,_0x37d508['w']=0x384,_0x37d508['h']=0x640;}if(_0x3b5574==0x5){_0x37d508['r']=_0x3b5574,_0x37d508['w']=0x78c84^0x788bc,_0x37d508['h']=0x54338^0x544b8;}if(_0x3b5574==(0x1d8c3^0x1d8c5)){_0x37d508['r']=_0x3b5574,_0x37d508['w']=0xd3cba^0xd3882,_0x37d508['h']=0x269af^0x261df;}let _0x4b5694={'code':0x74,'msg':_0x37d508};_0x489db4=_0xe446ca['encode'](_0xe446ca['fromObject'](_0x4b5694))['finish']();this['onSendChannelData_'](_0x489db4)['then'](_0x40ff7a=>{});}['backHome'](_0x5cde70){let _0x431e9c={'body':{'key':0x1000090}};_0x431e9c['code']=CODE_NUMBER['CodeKeyDown'];this['onSendChannelData_'](JSON['stringify'](_0x431e9c))['then'](_0x18a7ce=>{});let _0x579886={'body':{'key':0x1000090}};_0x579886['code']=CODE_NUMBER['CodeKeyUp'];this['onSendChannelData_'](JSON['stringify'](_0x579886))['then'](_0x36bd96=>{});}['clearUp'](_0x22e470){let _0x24c47c={'body':{'key':0x1010000}};_0x24c47c['code']=CODE_NUMBER['CodeKeyDown'];this['onSendChannelData_'](JSON['stringify'](_0x24c47c))['then'](_0x38c5f1=>{});let _0x5699cc={'body':{'key':0x1010000}};_0x5699cc['code']=CODE_NUMBER['CodeKeyUp'];this['onSendChannelData_'](JSON['stringify'](_0x5699cc))['then'](_0x31ec5a=>{});}['transitionToActive_'](){this['remoteVideo_']['oncanplay']=undefined;var _0x442b77=window['performance']['now']();this['infoBox_']['setSetupTimes'](this['startTime'],_0x442b77);this['infoBox_']['updateInfoDiv']();this['trace_']('Call\x20setup\x20time:\x20'+(_0x442b77-this['startTime'])['toFixed'](0xcdb7d^0xcdb7d)+'ms.');this['trace_']('reattachMediaStream:\x20'+this['localVideo_']['srcObject']);this['miniVideo_']['srcObject']=this['localVideo_']['srcObject'];this['activate_'](this['remoteVideo_']);this['activate_'](this['miniVideo_']);this['deactivate_'](this['localVideo_']);this['localVideo_']['srcObject']=null;this['activate_'](this['videosDiv_']);this['show_'](this['hangupSvg_']);this['displayStatus_']('');}['transitionToWaiting_'](){this['remoteVideo_']['oncanplay']=undefined;this['hide_'](this['hangupSvg_']);this['deactivate_'](this['videosDiv_']);if(!this['remoteVideoResetTimer_']){this['remoteVideoResetTimer_']=setTimeout(function(){this['remoteVideoResetTimer_']=null;this['trace_']('Resetting\x20remoteVideo\x20src\x20after\x20transitioning\x20to\x20waiting.');this['remoteVideo_']['srcObject']=null;}['bind'](this),0x6bead^0x6bd8d);}this['localVideo_']['srcObject']=this['miniVideo_']['srcObject'];this['activate_'](this['localVideo_']);this['deactivate_'](this['remoteVideo_']);this['deactivate_'](this['miniVideo_']);}['transitionToDone_'](){this['remoteVideo_']['oncanplay']=undefined;this['deactivate_'](this['localVideo_']);this['deactivate_'](this['remoteVideo_']);this['deactivate_'](this['miniVideo_']);this['hide_'](this['hangupSvg_']);this['activate_'](this['rejoinDiv_']);this['show_'](this['rejoinDiv_']);this['displayStatus_']('');this['displayTurnStatus_']('');}['pushCallNavigation_'](_0x59318f,_0x2c1ec4){window['history']['pushState']({'Id':_0x59318f,'roomLink':_0x2c1ec4},_0x59318f,_0x2c1ec4);}['displaySharingInfo_'](_0xbc43fb,_0x395f84){this['roomLinkHref_']['href']=_0x395f84;this['roomLinkHref_']['text']=_0x395f84;this['roomLink_']=_0x395f84;this['pushCallNavigation_'](_0xbc43fb,_0x395f84);this['activate_'](this['sharingDiv_']);}['displayStatus_'](_0x1f29f2){if(_0x1f29f2===''){this['deactivate_'](this['statusDiv_']);}else{this['activate_'](this['statusDiv_']);}this['statusDiv_']['innerHTML']=_0x1f29f2;}['displayTurnStatus_'](_0x543cc9){if(_0x543cc9===''){this['deactivate_'](this['turnInfoDiv_']);}else{this['activate_'](this['turnInfoDiv_']);}this['turnInfoDiv_']['innerHTML']=_0x543cc9;}['displayError_'](_0xf0812b){this['trace_'](_0xf0812b);}['toggleAudioMute_'](){var _0x4452aa=this['remoteStream_']['getAudioTracks']();if(_0x4452aa['length']===(0xe3e27^0xe3e27)){this['trace_']('No\x20local\x20audio\x20available.');return;}this['trace_']('Toggling\x20audio\x20mute\x20state.');for(var _0x140538=0x514c1^0x514c1;_0x140538<_0x4452aa['length'];++_0x140538){_0x4452aa[_0x140538]['enabled']=!_0x4452aa[_0x140538]['enabled'];}this['trace_']('Audio\x20'+(_0x4452aa[0x0]['enabled']?'unmuted.':'muted.'));}['toggleVideoMute_'](){var _0x401291=this['remoteStream_']['getVideoTracks']();if(_0x401291['length']===0x0){this['trace_']('No\x20local\x20video\x20available.');return;}this['trace_']('Toggling\x20video\x20mute\x20state.');for(var _0x4149a3=0x0;_0x4149a3<_0x401291['length'];++_0x4149a3){_0x401291[_0x4149a3]['enabled']=!_0x401291[_0x4149a3]['enabled'];}this['trace_']('Video\x20'+(_0x401291[0x0]['enabled']?'unmuted.':'muted.'));}['toggleFullScreen_'](){if(isFullScreen()){this['trace_']('Exiting\x20fullscreen.');document['querySelector']('svg#fullscreen\x20title')['textContent']='Enter\x20fullscreen';document['cancelFullScreen']();}else{this['trace_']('Entering\x20fullscreen.');document['querySelector']('svg#fullscreen\x20title')['textContent']='Exit\x20fullscreen';document['body']['requestFullScreen']();}this['fullscreenIconSet_']['toggle']();}['toggleMiniVideo_'](){if(this['miniVideo_']['classList']['contains']('active')){this['deactivate_'](this['miniVideo_']);}else{this['activate_'](this['miniVideo_']);}}['hide_'](_0x4cbb1b){_0x4cbb1b['classList']['add']('hidden');}['show_'](_0x574537){_0x574537['classList']['remove']('hidden');}['activate_'](_0x5caba8){_0x5caba8['classList']['add']('active');}['deactivate_'](_0x3d5c6d){_0x3d5c6d['classList']['remove']('active');}['loadUrlParams_'](){var _0x498c2b='H264';var _0x46620f=this['queryStringToDictionary_'](window['location']['search']);this['loadingParams_']['audioSendBitrate']=_0x46620f['asbr'];this['loadingParams_']['audioSendCodec']=_0x46620f['asc'];this['loadingParams_']['audioRecvBitrate']=_0x46620f['arbr'];this['loadingParams_']['audioRecvCodec']=_0x46620f['arc'];this['loadingParams_']['opusMaxPbr']=_0x46620f['opusmaxpbr'];this['loadingParams_']['opusFec']=_0x46620f['opusfec'];this['loadingParams_']['opusDtx']=_0x46620f['opusdtx'];this['loadingParams_']['opusStereo']=_0x46620f['stereo'];this['loadingParams_']['videoSendBitrate']=_0x46620f['vsbr'];this['loadingParams_']['videoSendInitialBitrate']=_0x46620f['vsibr'];this['loadingParams_']['videoSendCodec']=_0x46620f['vsc'];this['loadingParams_']['videoRecvBitrate']=_0x46620f['vrbr'];this['loadingParams_']['videoRecvCodec']=_0x46620f['vrc']||_0x498c2b;this['loadingParams_']['videoFec']=_0x46620f['videofec'];}['onSendChannelData_'](_0x3fe0b1){if(this['pcClient_']!==null){return this['pcClient_']['sendDataMessage'](_0x3fe0b1);}else{return new Promise((_0x475105,_0x32ac75)=>{_0x475105({'sendstatus':'failed','sendmessage':_0x3fe0b1});});}}['queryStringToDictionary_'](_0x11c083){var _0x35114b=_0x11c083['slice'](0x1)['split']('&');var _0x4cae75={};_0x35114b['forEach'](function(_0x3ad952){if(_0x3ad952){_0x3ad952=_0x3ad952['split']('=');if(_0x3ad952[0x0]){_0x4cae75[_0x3ad952[0x0]]=decodeURIComponent(_0x3ad952[0xe4f91^0xe4f90]||'');}}});return _0x4cae75;}['trace_'](_0x86549){if(this['loadingParams_']['debug']){console['log'](_0x86549);}}}export default AppController;