'use strict';export function PeerConnectionClient(_0x7bbdf3,_0x507a13){this['params_']=_0x7bbdf3;this['startTime_']=_0x507a13;this['singalUrl']='https://signal.ugame.ucloud.cn:8001/api/v1/';this['pc_']=new RTCPeerConnection(_0x7bbdf3['peerConnectionConfig'],null);if(this['params_']['mediaConstraints']['audio']){this['pc_']['addTransceiver']('audio',{'direction':'recvonly'});this['trace_']('only\x20receive\x20audio.');}if(this['params_']['mediaConstraints']['video']){this['pc_']['addTransceiver']('video',{'direction':'recvonly'});this['trace_']('only\x20receive\x20video.');}this['pc_']['ondatachannel']=this['onDataChannel_']['bind'](this);this['pc_']['onicecandidate']=this['onIceCandidate_']['bind'](this);this['pc_']['ontrack']=this['onRemoteStreamAdded_']['bind'](this);this['pc_']['onremovestream']=this['trace_']['bind'](this,'Remote\x20stream\x20removed.');this['pc_']['oniceconnectionstatechange']=this['onIceConnectionStateChanged_']['bind'](this);this['channel']=null;this['hasRemoteSdp_']=![];this['messageQueue_']=[];this['isInitiator_']=!![];this['started_']=![];this['recivedmessage']={};this['serial_']='';this['cadidateQueue_']=[];this['onerror']=null;this['oniceconnectionstatechange']=null;this['onnewicecandidate']=null;this['onremotestreamadded']=null;this['onchangedefinit']=null;this['onchangestatus']=null;this['onchangeicestatus']=null;this['onresolutionstatus']=null;this['onmessagehandle']=null;this['onchannelstatus']=null;this['trace_']('create\x20peerconnection\x20success.');};PeerConnectionClient['DEFAULT_SDP_OFFER_OPTIONS_']={'offerToReceiveAudio':0x1,'offerToReceiveVideo':0x1,'voiceActivityDetection':![]};PeerConnectionClient['prototype']['startCreateDataChannel']=function(){this['channel']=this['pc_']['createDataChannel']('uCloudGame',{'negotiated':![],'id':0x0,'ordered':![]});this['channel']['onopen']=()=>{this['onchannelstatus'](this['channel']['readyState']);};this['channel']['onerror']=_0x4f3535=>{const _0x1cfb4e=_0x4f3535['error'];this['onchannelstatus']('Data\x20Channel\x20\x27'+channel['protocol']+'\x27\x20error!\x20'+_0x1cfb4e['errorDetail']+'\x20-\x20'+_0x1cfb4e['message']);};this['channel']['onclose']=()=>{this['onchannelstatus']('close');};};PeerConnectionClient['prototype']['onDataChannel_']=function(_0x1e87d2){let _0x42de0d=_0x1e87d2['channel'];_0x42de0d['onmessage']=({data:_0x90a147})=>{this['onmessagehandle'](_0x90a147);};};PeerConnectionClient['prototype']['sendDataMessage']=function(_0x5eef79){return new Promise((_0x3f7daf,_0x197db9)=>{if(this['channel']['readyState']=='open'){this['channel']['send'](_0x5eef79);_0x3f7daf({'channelstate':this['channel']['readyState'],'sendstatus':'success','sendmessage':_0x5eef79});}else{_0x3f7daf({'channelstate':this['channel']['readyState'],'sendstatus':'fail','sendmessage':_0x5eef79});}});};PeerConnectionClient['prototype']['startAsCaller']=function(_0x5b8205){if(!this['pc_']){return![];}if(this['started_']){return![];}this['isInitiator_']=!![];this['started_']=!![];this['serial_']=this['generateUUID_']()['substring'](0x1bf3b^0x1bf3b,0xc5300^0xc5308);this['pc_']['createOffer']()['then'](this['setLocalSdpAndNotify_']['bind'](this))['catch'](this['onError_']['bind'](this,'createOffer'));return!![];};PeerConnectionClient['prototype']['close']=function(){if(!this['pc_']){return;}this['hasRemoteSdp_']=![];this['started_']=![];if(this['channel']!=null){this['channel']['close']();this['channel']=null;}if(this['pc_']!=null){this['pc_']['close']();this['pc_']=null;}this['trace_']('close\x20peerconnection\x20success.');};PeerConnectionClient['prototype']['getPeerConnectionStats']=function(_0x4874c2){if(!this['pc_']){return;}this['pc_']['getStats'](null)['then'](_0x4874c2);};PeerConnectionClient['prototype']['forceconnection']=function(){return new Promise((_0x1f8c5e,_0x5252da)=>{this['pc_']['createOffer']()['then'](_0x5cbe86=>{var _0x538933={'offer':'Request\x20force\x20connection','request_id':this['generateUUID_'](),'phone_id':this['params_']['Id'],'serial':this['generateUUID_']()['substring'](0xed0d3^0xed0d3,0xe4d77^0xe4d7f)};this['postRequest_'](this['singalUrl']+'send_offer_receive_answer',{..._0x538933})['then'](_0x1bdf09=>{this['analysisAnswer'](JSON['parse'](_0x1bdf09['data']['answer']));const _0x158f9d=JSON['parse'](_0x1bdf09['data']['answer']);_0x1f8c5e(_0x158f9d['code']);console['log'](_0x1bdf09);});});});};PeerConnectionClient['prototype']['setLocalSdpAndNotify_']=function(_0x16e623){this['pc_']['setLocalDescription'](_0x16e623)['then'](this['trace_']['bind'](this,'Set\x20local\x20description\x20success.'))['catch'](this['onError_']['bind'](this,'setLocalDescription'));var _0x52aad7={'request_id':this['generateUUID_'](),'phone_id':this['params_']['Id'],'offer':_0x16e623['sdp'],'serial':this['serial_']};this['postRequest_'](this['singalUrl']+'send_offer_receive_answer',{..._0x52aad7})['then'](_0x241e0c=>{this['trace_']('send\x20offer\x20description\x20success.');this['trace_'](this['params_']['Id']+'\x20iceConnectionState:\x20'+this['pc_']['iceConnectionState']);this['trace_'](_0x241e0c);if(_0x241e0c['code']==(0x251b5^0x251b5)){this['analysisAnswer'](JSON['parse'](_0x241e0c['data']['answer']));}else{var _0x38c315={'code':_0x241e0c['code']};this['analysisAnswer'](_0x38c315);this['trace_'](_0x241e0c['message_cn']);}})['catch'](_0x236a84=>{});};PeerConnectionClient['prototype']['analysisAnswer']=function(_0x461149){if(_0x461149['code']){var _0x4d7a33=_0x461149['code'];switch(_0x4d7a33){case 0x545dd^0x541df:this['onchangestatus'](_0x4d7a33);return;case 0x4c16d^0x4c286:this['onchangestatus'](_0x4d7a33);return;case 0x92332^0x920c2:this['onchangestatus'](_0x4d7a33);return;case 0x9736a^0x97083:this['onchangestatus'](_0x4d7a33);return;case 0x11d2a:this['onchangestatus'](_0x4d7a33);return;default:this['onchangestatus'](_0x4d7a33);return;}}this['setRemoteSdp_'](_0x461149);};PeerConnectionClient['prototype']['setRemoteSdp_']=function(_0x90784e){this['pc_']['setRemoteDescription'](new RTCSessionDescription(_0x90784e))['then'](this['onSetRemoteDescriptionSuccess_']['bind'](this))['catch'](this['onError_']['bind'](this,'setRemoteDescription'));};PeerConnectionClient['prototype']['onSetRemoteDescriptionSuccess_']=function(){this['trace_']('Set\x20remote\x20session\x20description\x20success.');this['hasRemoteSdp_']=!![];if(this['cadidateQueue_']['length']>0x0){this['sendCandidates'](this['cadidateQueue_']);}this['getCandidates']();};PeerConnectionClient['prototype']['onIceCandidate_']=function(_0x3545d3){if(_0x3545d3['candidate']){if(this['filterIceCandidate_'](_0x3545d3['candidate'])){let _0x1b44ba={'candidate':_0x3545d3['candidate']['candidate'],'sdp_m_line_index':_0x3545d3['candidate']['sdpMLineIndex'],'sdp_mid':_0x3545d3['candidate']['sdpMid']};if(this['hasRemoteSdp_']){this['sendCandidates'](_0x1b44ba);}else{this['cadidateQueue_']['push'](_0x1b44ba);}}}else{this['trace_']('End\x20of\x20candidates.');}};PeerConnectionClient['prototype']['sendCandidates']=function(_0x5e1fe7){if(this['pc_']===null||!this['started_']){return;}let _0x52c3b5=_0x5e1fe7;if(!Array['isArray'](_0x5e1fe7)){_0x52c3b5=[_0x5e1fe7];}var _0x109858={'request_id':this['generateUUID_'](),'phone_id':this['params_']['Id'],'candidates':_0x52c3b5,'serial':this['serial_']};this['postRequest_'](this['singalUrl']+'send_candidate',{..._0x109858})['then'](_0x57026d=>{if(_0x57026d['code']==0x0){this['trace_']('send\x20candidates\x20success');}});};PeerConnectionClient['prototype']['getCandidates']=function(){var _0x4ee904=0xc3491^0xc3490;this['postRequest_'](this['singalUrl']+'receive_candidate',{'request_id':this['generateUUID_'](),'phone_id':this['params_']['Id'],'serial':this['serial_']})['then'](_0x3e82ab=>{if(_0x3e82ab['code']==0x0){if(_0x3e82ab['data']['candidates']['length']!==0x0){var _0xb30108=_0x3e82ab['data']['candidates'];this['trace_'](this['params_']['Id']+'\x20receive\x20candidates\x20success.');for(let _0x1fbf75=0xa94bf^0xa94bf;_0x1fbf75<_0xb30108['length'];_0x1fbf75++){var _0x396be8={'sdpMLineIndex':_0xb30108[_0x1fbf75]['sdp_m_line_index'],'candidate':_0xb30108[_0x1fbf75]['candidate'],'sdpMid':_0xb30108[_0x1fbf75]['sdp_mid']};var _0x4edad7=new RTCIceCandidate({..._0x396be8});if(this['pc_']){this['pc_']['addIceCandidate'](_0x4edad7)['then']();}}}if(this['pc_']&&this['pc_']['iceConnectionState']!=='connected'){if(_0x4ee904>=0x14){console['log'](this['params_']['Id']+'candtimer'+_0x4ee904);_0x4ee904=0x96068^0x96068;return;}setTimeout(()=>{if(this['pc_']&&this['started_']){this['getCandidates']();++_0x4ee904;}else{clearTimeout();}},0x64);}else{clearTimeout();}}});};PeerConnectionClient['prototype']['onIceConnectionStateChanged_']=function(){if(!this['pc_']||!this['started_']){return;}this['onchangeicestatus'](this['pc_']['iceConnectionState']);if(this['oniceconnectionstatechange']){this['oniceconnectionstatechange']();}};PeerConnectionClient['prototype']['filterIceCandidate_']=function(_0x43f330){var _0x4156ca=_0x43f330['candidate'];var _0x59936d=_0x4156ca['split']('\x20')[0x7];if(_0x59936d==='host'||_0x4156ca['indexOf']('host')!==-0x1){this['trace_']('drop\x20host\x20type.');return![];}if(_0x4156ca['indexOf']('tcp')!==-0x1){return![];}if(this['params_']['peerConnectionConfig']['iceTransports']==='relay'&&_0x59936d!=='relay'){return![];}return!![];};PeerConnectionClient['prototype']['onRemoteStreamAdded_']=function(_0x25231f){if(_0x25231f['streams']&&_0x25231f['streams'][0x0]){this['onremotestreamadded'](_0x25231f['streams'][0x0]);}};PeerConnectionClient['prototype']['onError_']=function(_0x46e9ea,_0x53ee0b){if(this['onerror']){this['onerror'](_0x46e9ea+':\x20'+_0x53ee0b['toString']());}};PeerConnectionClient['prototype']['generateUUID_']=function(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'['replace'](/[xy]/g,function(_0x50211b){var _0x5c08ea=Math['random']()*0x10|0xa2c58^0xa2c58,_0x4a2b19=_0x50211b=='x'?_0x5c08ea:_0x5c08ea&(0x84578^0x8457b)|0x8;return _0x4a2b19['toString'](0x10);});};PeerConnectionClient['prototype']['postRequest_']=function(_0x5c79e7,_0x3b7506){return new Promise((_0x28efd9,_0x1d0960)=>{const _0x3452ee=new XMLHttpRequest();_0x3452ee['open']('post',_0x5c79e7);_0x3452ee['setRequestHeader']('content-type','application/json');_0x3452ee['send'](JSON['stringify'](_0x3b7506));_0x3452ee['onreadystatechange']=function(){if(_0x3452ee['readyState']===0x4){if(_0x3452ee['status']===0xc8){_0x28efd9(JSON['parse'](_0x3452ee['responseText']));}else{_0x1d0960('网络异常:'+_0x3452ee['statusText']);}}};});};PeerConnectionClient['prototype']['trace_']=function(_0x5221c3){if(!this['params_']['debug']){return;}if(_0x5221c3[_0x5221c3['length']-(0x7c26e^0x7c26f)]==='\x0a'){_0x5221c3=_0x5221c3['substring'](0x0,_0x5221c3['length']-0x1);}if(window['performance']){var _0x358436=(window['performance']['now']()/(0x8433c^0x840d4))['toFixed'](0xec019^0xec01a);console['log'](_0x358436+':\x20'+_0x5221c3);}else{console['log'](_0x5221c3);}};export function transKeyCode(_0x5f12be){console['log'](_0x5f12be);var _0xbf6525=_0x5f12be;switch(_0x5f12be){case 0x8:_0xbf6525=0x1000003;return _0xbf6525;case 0x9:_0xbf6525=0x1000001;return _0xbf6525;case 0xa32ff^0xa32f2:_0xbf6525=0x1000005;return _0xbf6525;case 0x10:_0xbf6525=0x1000020;return _0xbf6525;case 0xacc81^0xacc90:_0xbf6525=0x1000021;return _0xbf6525;case 0x12:_0xbf6525=0x1000023;return _0xbf6525;case 0xc819f^0xc818b:_0xbf6525=0x1000024;return _0xbf6525;case 0x1b:_0xbf6525=0x1000000;return _0xbf6525;case 0x20:_0xbf6525=0x1d777^0x1d757;return _0xbf6525;case 0x25:_0xbf6525=0x1000012;return _0xbf6525;case 0x26:_0xbf6525=0x1000013;return _0xbf6525;case 0x27:_0xbf6525=0x1000014;return _0xbf6525;case 0x28:_0xbf6525=0x1000015;return _0xbf6525;case 0x2d:_0xbf6525=0x1000006;return _0xbf6525;case 0x2e:_0xbf6525=0x1000007;return _0xbf6525;case 0x74096^0x740f6:_0xbf6525=0x30;return _0xbf6525;case 0x61:_0xbf6525=0xc41ea^0xc41db;return _0xbf6525;case 0x62:_0xbf6525=0x6fcb1^0x6fc83;return _0xbf6525;case 0x63:_0xbf6525=0x6cef2^0x6cec1;return _0xbf6525;case 0x984e3^0x98487:_0xbf6525=0x34;return _0xbf6525;case 0x65:_0xbf6525=0x35;return _0xbf6525;case 0x50dbb^0x50ddd:_0xbf6525=0x36;return _0xbf6525;case 0x67:_0xbf6525=0xd3d9a^0xd3dad;return _0xbf6525;case 0x68:_0xbf6525=0x38;return _0xbf6525;case 0x43546^0x4352f:_0xbf6525=0x4a22a^0x4a213;return _0xbf6525;case 0x6a:_0xbf6525=0x423d9^0x423bb;return _0xbf6525;case 0x6b:_0xbf6525=0x64;return _0xbf6525;case 0x294e4^0x29488:_0xbf6525=0x65;return _0xbf6525;case 0xbc5ce^0xbc5a3:_0xbf6525=0x63;return _0xbf6525;case 0xdac37^0xdac59:_0xbf6525=0x9779d^0x977b3;return _0xbf6525;case 0x4f749^0x4f726:_0xbf6525=0x61;return _0xbf6525;case 0x9e98b^0x9e9fb:_0xbf6525=0x1000030;return _0xbf6525;case 0x71:_0xbf6525=0x1000031;return _0xbf6525;case 0x72:_0xbf6525=0x1000032;return _0xbf6525;case 0xb773b^0xb7748:_0xbf6525=0x1000033;return _0xbf6525;case 0x74:_0xbf6525=0x1000034;return _0xbf6525;case 0xab8bd^0xab8c8:_0xbf6525=0x1000035;return _0xbf6525;case 0x76:_0xbf6525=0x1000036;return _0xbf6525;case 0xed759^0xed72e:_0xbf6525=0x1000037;return _0xbf6525;case 0x78:_0xbf6525=0x1000038;return _0xbf6525;case 0x79:_0xbf6525=0x1000039;return _0xbf6525;case 0x7a:_0xbf6525=0x100003a;return _0xbf6525;case 0xa4f41^0xa4f3a:_0xbf6525=0x100003b;return _0xbf6525;case 0xc8abe^0xc8a2e:_0xbf6525=0x1000025;return _0xbf6525;case 0x5ffd1^0x5ff6b:_0xbf6525=0x703d9^0x703e2;return _0xbf6525;case 0x999f8^0x99943:_0xbf6525=0xe5e89^0xe5eb4;return _0xbf6525;case 0xbc:_0xbf6525=0x2c;return _0xbf6525;case 0xbd:_0xbf6525=0x2d;return _0xbf6525;case 0xbe:_0xbf6525=0x2e;return _0xbf6525;case 0xbf:_0xbf6525=0x9cd23^0x9cd0c;return _0xbf6525;case 0xc0:_0xbf6525=0x60;return _0xbf6525;case 0xdb:_0xbf6525=0x5b;return _0xbf6525;case 0x3bed7^0x3be0b:_0xbf6525=0x6aae4^0x6aab8;return _0xbf6525;case 0xdd:_0xbf6525=0x5d;return _0xbf6525;case 0xde:_0xbf6525=0x27;return _0xbf6525;}return _0xbf6525;}